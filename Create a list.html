<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: "Roboto";
    }

    #mainList {
      border: none;
      padding: 0;
      margin: 0;
      padding-bottom: 50px;
      /* opacity: 0; */
      background-color: rgba(255, 255, 255, 0);

    }

    .selectTagHeading {
      display: inline-block;
      font-size: 35px;
      font-weight: 400;
    }

    li {
      border: none;
      list-style: none;
      outline: none;
      text-decoration: none;
      /* display: flex;
      justify-content: space-between;
      flex-wrap: wrap; */
    }

    input {
      border: none;
      outline: none;
      font-size: 35px;
      color: black;
      background-color: rgba(255, 255, 255, 0);
      font-weight: 400;
    }

    button {
      font-weight: 300 !important;
    }

    .big_SuccessBtn {
      background-color: #BADA55;
      border: none;
      height: 45px;
      width: 144px;
      border-radius: 10px;
      font-size: 18px;
    }

    .innerDiv .big_SuccessBtn:hover {
      border: 1px solid black;
      background-color: white;

    }

    .big_DangerBtn {
      height: 45px;
      font-size: 18px;
      border: 1px solid black;
      width: 144px;
      border-radius: 10px;
      background-color: #F1F1F1;
      margin-right: 20px;
    }



    .btn-success {
      background-color: #BADA55;
      border: none;
      height: 38px;
      width: 103px;
      border-radius: 10px;
      font-size: 16px;
      margin-right: 20px;
    }

    .btn-success:hover {
      border: 1px solid black;
      background-color: white;
    }

    .btn-danger {
      height: 38px;

      font-size: 16px;
      border: 1px solid black;
      background-color: white;
      width: 103px;
      border-radius: 10px;
    }

    #tagSelectBtn {
      margin-top: -25px !important;
      margin-bottom: 20px;
    }

    .btn-danger:hover {
      background-color: #F1F1F1;
      /* border: none; */
    }


    .x {
      font-size: 20px;
    }

    .main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      /* padding-top: 70px; */
      /* padding-bottom: 70px; */
      border-bottom: 1px solid black;
    }

    .filterH2 {
      font-size: 80px;
      font-weight: 400 !important;
    }

    /* .firstDiv {
      background-color: #f1f1f1; 
      padding: 34px;

    } */

    .selectDiv {
      background-color: white;
      margin-top: 80px;
      min-height: 425px;
      border-radius: 30px;
      box-shadow: 2px 2px 15px rgba(128, 128, 128, 0.541);
      width: 100%;
      margin: 0 auto;
      padding-bottom: 50px;
    }

    .sub {
      padding-top: 80px;
      margin: 80px;
      border-bottom: 2px solid #BADA55;
      /* background-color: #F1F1F1; */
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .subDiv {

      margin-left: 80px;
      margin-right: 80px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      padding: 34px;
      background-color: #F1F1F1;
      border-radius: 10px;
    }

    .mainFilterDiv {

      margin-top: 80px;
      min-height: 425px;
      border-radius: 30px;
      box-shadow: 2px 2px 15px rgba(128, 128, 128, 0.541);
      padding-bottom: 80px;
      background-color: white !important;

    }

    .listitem {
      display: flex;
      padding-top: 80px;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin: 80px;
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 2px solid #BADA55;

    }

    .subtagList {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
      margin-top: 12px;
    }

    .category input {
      font-size: 22px;
      font-weight: 400;
    }

    .tags input {
      font-size: 16px;
      font-weight: 400;
    }

    .innerTagDiv {
      background-color: #F1F1F1;
      padding: 34px;
      margin-bottom: 20px;
      margin: 40px 80px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* align-items: flex-end; */
    }

    #tagSelectBtn {
      align-self: flex-end;

    }

    .swal-modal {
      width: 650px;
      min-width: 320px;
      padding: 40px 70px;
      border-radius: 30px;
      border: 1px solid black;

    }

    /* //style of scrollbar */
    ::-webkit-scrollbar {
      width: 5px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
      background: black;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* //style of scrollbar */
    .swal-overlay {
      background-color: rgba(255, 255, 255, 0.733);
    }

    .swal-footer {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .swal-modal button {
      background-color: #BADA55 !important;
      font-weight: 300;
      width: 144px;
      border: 2px solid #BADA55;


    }

    .swal-modal button:hover {
      background-color: white !important;
      border: 2px solid #BADA55;
      color: black;

    }

    .swal-modal input {
      border: 1px solid rgb(85, 85, 85);
      font-weight: 400;
      color: black;
      margin-top: 40px;
    }

    .swal-modal input:focus {

      border: 1px solid rgb(85, 85, 85);
      box-shadow: 0px 1px 1px 1px rgba(87, 87, 87, 0.219);

    }

    .swal-title {
      margin-bottom: 30px;
      border-bottom: 1px solid #BADA55;
    }

    .swal-title:first-child {
      margin: 0;
    }

    .swal-title {
      padding-bottom: 20px;
    }

    .swal-title:not(:first-child) {
      padding-bottom: 30px;
    }

    .mainListDiv {
      opacity: 1;
      /* background-color: rgba(255, 255, 255, 0); */
    }

    button {
      font-family: "Roboto";

    }

    .selectSubCat {
      padding-top: 20px;
      width: 200px;
    }

    /* //style for existing tags */
    .childDiv {
      margin-bottom: 25px;
    }

    .childDiv input {
      font-size: 16px !important;

    }

    .btns {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      width: 250px;
      font-weight: 300;
    }

    .cat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
    }

    .cat input {
      font-size: 18px !important;
      font-weight: 400;

    }

    .mainListDiv {
      background-color: #ffffff00;
    }

    .subTagsdiv {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      background-color: #F1F1F1;
      padding: 20px;
      border-radius: 12px;
    }

    .selectCatexist {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #F1F1F1;
      padding: 20px;
      border-radius: 12px;
    }

    .addedFilters {
      margin: 80px;
    }
    .subivCat > div{
      margin: 0 !important;
      padding: 34px !important;
    }
    .selectDv{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 34px 10px;
    }
  </style>
</head>

<body>

  <div class="main container" id="main">
    <h2 class="filterH2">Filter</h2>
    <div class="inner-div">
      <button class="btn big_DangerBtn" onclick="reset()"><span class="x">X</span> Clear All</button>
      <button class=" big_SuccessBtn" onclick="sendData()">Save Changes</button>
    </div>
    <!-- <input id="mainInput" type="text" disabled value="Select Tag Heading" class="form-control" /> -->
  </div>

  <div class="mainListDiv">
    <ul id="mainList"></ul>
  </div>
  <div class="selectDiv">
    <div class="sub">
      <h2 class="selectTagHeading">Select Tag Heading</h2>
      <button class="big_SuccessBtn" onclick="start()">Select</button>
    </div>
    <div id="addedFilters" class="addedFilters">

    </div>
  </div>

  <script>
    let objArray = []
    window.onmessage = (event) => {
      addedFilters(event.data.data)
    }
    var arrayCount = 0;
    function start() {

      //create heading //
      arrayCount++
      swal({
        title: "Select Tag Heading",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",
            button: "success"
          },
        },
      }).then((res) => {
        //slice the  text and capitalize first word

        try {
        res=res.toUpperCase()

        } catch (error) {
          console.log(error);
        }
        if (res.trim() == "" || null || undefined) {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          createFun(res);
          createArray(res, "heading")
        }
      });
    }
    function createFun(data) {
      let liValue = data;

      //creating set of elements and append in div assigning attrbutes
      let list = document.getElementById("mainList");
      let FirstDiv = document.createElement("div")
      let divLi = document.createElement("div");
      let li = document.createElement("li");
      let inp = document.createElement("input");
      // let edit = document.createElement("button");
      let del = document.createElement("button");
      let subLi = document.createElement("div");
      let subDiv = document.createElement("div");
      let selectBtn = document.createElement("button");
      let selectCatogery = document.createElement("span")

      // edit.innerHTML = "EDIT";
      del.innerHTML = "DELETE";
      selectBtn.setAttribute("class", "btn-danger")
      selectBtn.innerHTML = "Select";
      selectBtn.setAttribute("id", "select");
      selectBtn.setAttribute(
        "onclick",
        "createInnerTag(this.parentElement.parentElement,this)"
      );

      selectCatogery.innerHTML = "Select Category"
      selectCatogery.setAttribute("class", "selectCat")

      FirstDiv.setAttribute("class", "firstDiv")
      divLi.setAttribute("class", "mainFilterDiv")
      // edit.setAttribute("id", "edit");
      // edit.setAttribute("onclick", "updt(this.parentElement)");
      // edit.setAttribute("class", " btn btn-success");

      del.setAttribute("id", "del");
      del.setAttribute("onclick", "del(this.parentElement.parentElement.parentElement,this.parentElement)");
      del.setAttribute("class", "btn btn-danger ");

      inp.setAttribute("id", "listInput");
      inp.setAttribute("disabled", "disabled");
      inp.setAttribute("class", "list-input form-control");

      li.setAttribute("id", "li");
      li.setAttribute("class", "listitem");

      subDiv.setAttribute("class", "subDiv")
      subLi.setAttribute("class", "subLi")

      list.appendChild(FirstDiv);
      FirstDiv.appendChild(divLi)
      divLi.appendChild(li);
      divLi.appendChild(subDiv)
      li.appendChild(inp);
      li.appendChild(subLi);
      // subLi.appendChild(del);
      subDiv.appendChild(selectCatogery);
      subDiv.appendChild(selectBtn);
      // subLi.appendChild(edit);
      subLi.appendChild(del);

      inp.value = liValue;
      console.log("swal value...........", liValue);// mainInput.value = "";
    }
    //first function ends

    //........second function...............................function for sub tag............................


    //trigger function on select button  create  category
    function createInnerTag(parentRes, btn) {
       swal({
        title: "Select Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",
          },
        },
      }).then((res) => {
        try {
          
          // const lower = res.toLowerCase();
          // res = res.charAt(0).toUpperCase() + lower.slice(1);
        } catch (error) {
          console.log(error);
        }
        if (res.trim() == "" || res == "") {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          if(btn.name!=="up"){
            createArray(res, 'innertag')

          }
          //creating elements and setting attribute  for catogeries
          let subLi = document.createElement("li");
          let inpSub = document.createElement("input");
          let buttonsDiv = document.createElement("div");

          let subDel = document.createElement("button");
          let subEdit = document.createElement("button");
          let tagSelectBtn = document.createElement("button");
          let innerTagDiv = document.createElement("div");
          let selectSubCatogery = document.createElement("span")

          selectSubCatogery.innerHTML = "Select Sub Category"
          selectSubCatogery.setAttribute("class", "selectSubCat")

          inpSub.value = res;
          tagSelectBtn.innerHTML = "Select";
          tagSelectBtn.setAttribute("id", "tagSelectBtn");
          tagSelectBtn.setAttribute("class", "btn-danger")
          tagSelectBtn.setAttribute(
            "onclick",
            "createSubTag(this.parentElement,this)"
          );

          tagSelectBtn.style.marginTop = "12px";
          subLi.setAttribute("class", "subtagList category")
          innerTagDiv.setAttribute("class", "innerTagDiv")
          subEdit.innerHTML = "EDIT";
          subDel.innerHTML = "DELETE";
          subEdit.setAttribute("id", "subEdit");
          subEdit.setAttribute("onclick", "updt(this.parentElement)");
          subEdit.setAttribute("class", " btn btn-success");

          inpSub.setAttribute("id", "subInput");
          inpSub.setAttribute("disabled", "disabled");
          inpSub.setAttribute("class", "list-input form-control");

          subDel.setAttribute("id", "subDel");
          subDel.setAttribute(
            "onclick",
            "del(this.parentElement.parentElement.parentElement,this.parentElement)"
          );
          subDel.setAttribute("class", "btn btn-danger ");

          parentRes.appendChild(innerTagDiv);
          innerTagDiv.appendChild(subLi);
          subLi.appendChild(inpSub);
          subLi.appendChild(buttonsDiv);
          buttonsDiv.appendChild(subEdit);
          buttonsDiv.appendChild(subDel);

          innerTagDiv.appendChild(selectSubCatogery);
          innerTagDiv.appendChild(tagSelectBtn);
        }
      });


    }
    //.............................second function ends...............

    // .............................third sub tag function starts.................\
    let createSubTag = (data) => {
      //trigger swal get values in swwetalert input and if its not empty update on dom created input
      swal({
        title: "Select Sub Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",

          },
        },
      }).then((res) => {
        try {
          const lower = res.toLowerCase();
          res = res.charAt(0).toUpperCase() + lower.slice(1);

        } catch (error) {
        }

        if (res.trim() == "null" || res == "") {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          if(parentElement.parentElement.previousElement.lastElementChild.name!=="up"){
            createArray(res, 'subtag')
 
          }
          //sub category tags  create elements and append  
          let tagLi = document.createElement("li");
          let tagInpt = document.createElement("input");
          let tagButtonDiv = document.createElement("div")
          let tagDel = document.createElement("button");
          let tagEdit = document.createElement("button");

          //setting attributes for later functionality and style
          tagLi.setAttribute("class", "subtagList tags")
          tagEdit.innerHTML = "EDIT";
          tagDel.innerHTML = "DELETE";
          tagEdit.setAttribute("id", "tagEdit");
          tagEdit.setAttribute("onclick", "updt(this.parentElement)");
          tagEdit.setAttribute("class", " btn btn-success");

          tagInpt.setAttribute("id", "listInput");
          tagInpt.setAttribute("disabled", "disabled");
          tagInpt.setAttribute("class", "list-input form-control");

          tagDel.setAttribute("id", "tagDel");
          tagDel.setAttribute("onclick", "del(this.parentElement.parentElement,this.parentElement)");
          tagDel.setAttribute("class", "btn btn-danger ");

          data.appendChild(tagLi);
          tagLi.appendChild(tagInpt);
          tagLi.appendChild(tagButtonDiv);
          tagButtonDiv.appendChild(tagEdit)
          tagButtonDiv.appendChild(tagDel);

          tagInpt.value = res;
        }
      });
    };

    // .............................third sub tag function end.................
    let arr = []; //nested array of new tags 
    function reset() {
      //remove every new  filter from dom and clear data of it 
      arr = []
      arrayCount = 0;
      let list = document.getElementById("mainList");
      swal("Removed", "List Cleared", "success");
      list.innerHTML = "";
    }
    //....................edit button function


    function updt(edit) {
      let preVal = edit.previousElementSibling.value


      //trigger sweet alert takes a value and trigger inner update function if value is not emmpty
      swal({
        title: "Edit Tag",
        content: {
          element: "input",
          attributes: {
            placeholder: "Edit",
            value:preVal,
            type: "text",
          },
        },
      }).then((res) => {
        // get previous value and sent to main update function?
        innerupdate(edit, res, preVal);
      });
    }
    //........................... update value in input from sweet alert
    function innerupdate(edit, res, preVal) {
      if (res.trim() == "" || null) {
        swal("Edit", "Value cant be Empty", "error");
      } else {
        swal("Edit", "Title Edited", "success");
        // console.log("log dit.previousSibling....", edit.previousSibling);
        let newVal = edit.previousElementSibling.value = res;
        // get the values and compaire in array loop through  and replace  previous array data with new?
        for (let z = 0; z < arr.length; z++) {
          if (arr[z] == undefined) {
          } else {
            if (!Array.isArray(arr[z]) && arr[z] == preVal) {
              arr[z] = newVal
              // console.log(arr);
              break;
            }

            if (Array.isArray(arr[z])) {
              for (let a = 0; a < arr[z].length; a++) {

                if (Array.isArray(arr[z][a])) {
                  for (let l = 0; l < arr[z][a].length; l++) {
                    if (!Array.isArray(arr[z][a][l]) && arr[z][a][l] == preVal) {
                      arr[z][0][a] = newVal
                      break;
                    }
                    else {

                      for (let p = 0; p < arr[z][a][l].length; p++) {
                        if (!Array.isArray(arr[z][a][l][p]) && arr[z][a][l][p] == preVal) {
                          arr[z][a][l][p] = newVal
                          break;
                        }
                      }
                    }

                  }
                }




              }
            }
          }
        }

      }



    }

    function del(data, updata) {
      //..........................remove element.....................

      // get data from input removed and remove it from array
      let newVal = updata.previousElementSibling.value;
      for (let z = 0; z < arr.length; z++) {
        if (arr[z] == undefined) {
        } else {
          if (!Array.isArray(arr[z]) && arr[z] == newVal) {
            let index = arr.indexOf(newVal)
            arr = []

            break;
          }

          if (Array.isArray(arr[z])) {
            for (let a = 0; a < arr[z].length; a++) {
              for (let x = 0; x < arr[z][a].length; x++) {
                if (!Array.isArray(arr[z][a][x]) && arr[z][a][x] == newVal) {
                  arr[z][a].splice(a, 1)

                  break;
                } else {

                  for (let p = 0; p < arr[z][a][x].length; p++) {
                    if (!Array.isArray(arr[z][a][x][p]) && arr[z][a][x][p] == newVal) {
                      arr[z][a][x].splice(p, 1)
                      // console.log(arr);
                    }
                  }
                }
              }



            }
          }
        }
      }
// after removing data remove element from dom
      data.remove();
      swal("Remove", "Tag removed", "success");
    }

    //create array
    let head = 1
    let category = -1
    function createArray(data, prop) {

      console.log("logging data in create array  prop", prop);
      if (prop == "heading") {
        arr.push(data, [])
      } else if (prop == "innertag") {

        arr[1].push([data, []])
        category++
      } else if (prop == "subtag") {

        arr[1][category][1].push(data)

      }
    }




    //################################### added filters render###############################
    let addedFilters = (main) => {
      for (let b = 0; b < main.length; b++) {
        var newEl = main[b][0];
        let newObj = {}
        newObj[newEl] = main[b]
        objArray.push(newObj)


      }
      //loop through existing array and render 
      let tags = document.getElementById("addedFilters");
      for (let x = 0; x < main.length; x++) {
        let mainDiv = document.createElement("div");
        let btns = document.createElement("div");
        // mainDiv.style.width = "400px";
        let heading = document.createElement("input");
        let selectDiv=document.createElement("div")
        selectDiv.setAttribute("class","selectDv")
        let  subdiv=document.createElement("div")
        subdiv.setAttribute("class","subivCat")

        heading.style.padding = "10px";
        heading.style.fontSize = "40px";
        heading.disabled = "true";
        heading.setAttribute("name", `${JSON.stringify(main[x])}`)
        heading.style.borderBottom = "2px solid #BADA55";
        // add remove  button on main head in  existing filters
        btns.innerHTML = `
            <button class="btn-danger" name="head" id="delx" onclick="delExisting(this.parentElement.parentElement,this.parentElement,this.name)"  style="float: right; margin-right: 10px;display:inline-block; margin-top:-52px;">Delete</button>`;
       
            






//new code adding to old






        selectDiv.innerHTML=`<span>Select Category</span><button class="btn-danger" name="up" onclick="createInnerTag(this.parentElement.nextElementSibling,this,console.log(this.parentElement.nextElementSibling))" >Select</button>`
        mainDiv.append(heading);
        mainDiv.append(btns)
        mainDiv.appendChild(selectDiv)
        mainDiv.appendChild(subdiv)
        heading.value = main[x][0];
        let arr = main[x][1];
        for (let i = 0; i < arr.length; i++) {
          //.............................first loop......................

          //...............................second loop...........................

          for (let z = 0; z < arr[i].length; z++) {
            let childDiv = document.createElement("div");

            childDiv.setAttribute("class", "childDiv");
            childDiv.setAttribute("id", `${arr[i][0].replace(/ /g, "").toLowerCase().toString()}`);
            childDiv.style.display = "";
            let fstChild = document.createElement("div");
            if (arr[i][z] == undefined) {
            } else {
              if (!Array.isArray(arr[i][z]) ) {

                fstChild.innerHTML += `<div class="cat"> 
    <input   class="heading"  style="margin-bottom:10px" disabled placeholder="${arr[i][z]
                  }" id="${arr[i][z].replace(/ /g, "")}append" name="${i.toString() + ""}" value="${arr[i][z]
                  }"> 
          <div class="btns ">
            <button class="btn-danger" id="${arr[i][z].replace(/ /g, "")}del" onclick="delExisting(this.parentElement.parentElement,this.parentElement)"  style=" margin-right: 10px;">Delete</button>
            <button class="btn-success" id="${arr[i][z].replace(/ /g, "")}edt"onclick="updtExist(this.parentElement)" style=" margin-right: 0px;" >Edit</button>
            </div>
    </div>
    <div class="selectCatexist"  >
      <span>Add Subcatogery</span> 
      <button class="btn-danger" onclick="addTagAddedFilter(this.parentElement.previousElementSibling.firstElementChild)" >Select</button>
      </div>

    `;
                mainDiv.append(fstChild);
              }
            }
            if (Array.isArray(arr[i][z]) && arr[i][z].length ) {
              console.log("logging length of tags array",arr[i][z].length);
              //................................third loop..................................//
              let text = "";
              let a = 0;
              do {


           
                childDiv.innerHTML += `<div class="subTagsdiv"  style=" margin-left: 35px;">
    <input   style=" margin-left: 15px;" disabled placeholder="${arr[i][z][a]
                  }" id="${arr[i][z][a].replace(/ /g, "")}" name="${(i.toString() + "," + a.toString())
                  }" value="${arr[i][z][a]}"> 
                   <div class="btns"><button class="btn-danger" id="${arr[i][z][a].replace(/ /g, "")}del" name="subCat" onclick="delExisting(this.parentElement.parentElement,this.parentElement,this.name)" style=" margin-right: 10px;">Delete</button>
                    <button class="btn-success" id="${arr[i][z][a].replace(/ /g, "")}edt" onclick="updtExist(this.parentElement)" style=" margin-right: 0px;" >Edit</button></div>
    </div>`;

                mainDiv.append(childDiv);
                a++;
              }
              while (a < arr[i][z].length);
            } else {
              mainDiv.append(childDiv);
            }
            tags.append(mainDiv);
          }
        }
      }
    }


    //add catogery to existing filter
    let addTagAddedFilter = (data) => {
      swal({
        title: "Add Sub Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Add",
            type: "text",
          },
        },
      }).then((res) => {
        let divId = data.value.replace(/ /g, "").toLowerCase().toString()
        let divToAppen = document.getElementById(divId)
        let ipts = document.createElement("div")
        ipts.setAttribute("class", "subTagsdiv")
        ipts.style.marginLeft = "35px"
//functionality for adding more tags in to existing filters

        ipts.innerHTML = `
    <input   style=" margin-left: 15px;" disabled placeholder="" id="${res.replace(/ /g, "")}" name="${(res.toString())}" 
            value="${res}"> 
             <div class="btns">
              <button type="button" class="btn-danger" id="${res.replace(/ /g, "")}del" name="subCat" onclick="delExisting(this.parentElement.parentElement,this.parentElement,this.name)" style=" margin-right: 10px;">Delete</button>
              <button  class="btn-success" onclick="updtExist(this.parentElement)" id="${res.replace(/ /g, "")}edt"  style=" margin-right: 0px;" >Edit</button>
              </div>`
        divToAppen.append(ipts)
//pass  new tags data to add into main array
        NewTagsToEsisting(data.parentElement.parentElement.firstElementChild.firstElementChild.value, data.parentElement.parentElement.parentElement.firstElementChild.name, res)
      });
    }

    //update existing filters

    //....................edit button function
    function updtExist(edit) {
      let preVal = edit.previousElementSibling.value
      console.log("preVal ", preVal)
    

      //trigger sweet alert takes a value and trigger inner update function if value is not emmpty
      swal({
        title: "Update",
        content: {
          element: "input",
          attributes: {
            placeholder: "Edit",
            value: preVal,
            type: "text",
          },
        },
      }).then((res) => {
        innerupdatExist(edit, res, preVal);
      });
    }
    //........................... update value in input from sweet alert

    let existingArr = [];
    function innerupdatExist(edit, res, preVal) {
      if (existingArr.length == 0) {
        existingArr = JSON.parse(edit.parentElement.parentElement.parentElement.firstElementChild.name)
      }
      //get values  saved in attribute and compare go get index where to update data
      if (res.trim() == "" || null) {
        swal("Edit", "Value cant be Empty", "error");
      } else {
        swal("Edit", "Title Edited", "success");
        let newVal = edit.previousElementSibling.value = res;
        for (let z = 0; z < existingArr.length; z++) {
          if (existingArr[z] == undefined) {
          } else {
            if (!Array.isArray(existingArr[z]) && existingArr[z] == preVal) {
              existingArr[z] = newVal
              // console.log(existingArr);
              break;
            }

            if (Array.isArray(existingArr[z])) {
              for (let a = 0; a < existingArr[z].length; a++) {

                if (Array.isArray(existingArr[z][a])) {
                  for (let l = 0; l < existingArr[z][a].length; l++) {
                    if (!Array.isArray(existingArr[z][a][l]) && existingArr[z][a][l] == preVal) {
                      existingArr[z][0][a] = newVal
                      break;
                    }
                    else {
                  
                      for (let p = 0; p < existingArr[z][a][l].length; p++) {
                        if (!Array.isArray(existingArr[z][a][l][p]) && existingArr[z][a][l][p] == preVal) {
                          existingArr[z][a][l][p] = newVal
                          break;
                        }
                      }
                    }

                  }
                }

              }
            }
          }
          //check if that object is present if exist replace else push 
          let updArr = {}
          let objProperty = existingArr[0]
          updArr[objProperty] = existingArr
          if (objArray.length == 0) {
            objArray.push(updArr)
          } else {
            for (let p = 0; p < objArray.length; p++) {
              // console.log("property and obj",objProperty, objArray[p][objProperty]);
              // var headName=
              let element = objArray[p];
              // console.log("log objects one by one",element);
              if (objArray[p][objProperty]) {
                objArray[p] = updArr
                // console.log("check if object changed", objArray[p]);
              } else {
                // objArray.push({newVal:updArr})
                console.log("no data found");
              }
            }
          }
         
        }
      }
     
    }
  
    function delExisting(data, updata, newProp) {
      //..........................remove element.....................
      // remove data and dome element 
      let existingArr;
      let name;
      let flag = false;
      if (newProp == "head") {
        name = updata.previousElementSibling.name
      } else {

        name = updata.parentElement.parentElement.parentElement.firstElementChild.name
      }
      name = JSON.parse(name)
      name = name[0]
      // console.log("name of object", name);
      for (let l = 0; l < objArray.length; l++) {
        // let element = objArray[l];
        // console.log("log object array value", objArray[l]);
        if (objArray[l][name]) {
          if (newProp == "head") {
            objArray.splice(l, 1)
          } else {
            flag = true
            existingArr = objArray[l][name]
          }
        } else {
        }

      }
      if (flag) {

        let newVal = updata.previousElementSibling.value;
        for (let z = 0; z < existingArr.length; z++) {
          if (existingArr[z] == undefined) {
            // existing array is undefiened
            console.log("existing array is undefiened");
          } else {
            if (!Array.isArray(existingArr[z]) && existingArr[z] == newVal) {
              let index = existingArr.indexOf(newVal)
              existingArr = []
              break;
            }
            //filter category
            if (Array.isArray(existingArr[z])) {
              for (let a = 0; a < existingArr[z].length; a++) {
                for (let x = 0; x < existingArr[z][a].length; x++) {
                  if (!Array.isArray(existingArr[z][a][x]) && existingArr[z][a][x] == newVal) {
                    existingArr[z].splice(a,1)
                    console.log("aray in cat", existingArr[z][a]);

                
                    break;
                  } else {
                    console.log("is an array in tags")
                    //filter data in sub tags 
                    for (let p = 0; p < existingArr[z][a][x].length; p++) {
                      if (!Array.isArray(existingArr[z][a][x][p]) && existingArr[z][a][x][p] == newVal) {
                        updR=existingArr[z][a][x] 
                        existingArr[z][a][x] =  updR.filter(function(updR) {return updR != newVal});
                        if (existingArr[z][a][x]==[]) {
                          existingArr[z][a].splice(x,1)
                        }else{

                        }
                        console.log(existingArr[z][a][x]);
                      }
                    }
                  }
                }
              }
            }
          }

        }

 
        if (newProp == "subCat") {
          data.remove();
        } else if (newProp == "head") {
          data.remove()
        } else {
          try {

            data.parentElement.nextElementSibling.nextElementSibling.remove()
            data.parentElement.nextElementSibling.remove()
            data.parentElement.remove()
          } catch (error) {
            data.parentElement.nextElementSibling.remove()
            data.parentElement.remove()

          }
        }
  
        swal("Remove", "Tag removed", "success");
      }
      data.remove();
      swal("Remove", "Tag removed", "success");
    }

    //add new tags data to existing tags
    //update data  add new data to main oject
    let NewTagsToEsisting = (catNew, headArray, res) => {
      headArray = JSON.parse(headArray)
      let name = headArray[0]
      for (let l = 0; l < objArray.length; l++) {

        console.log("log object array value", objArray[l][name]);
        
        if (objArray[l][name]) {
          existingArr = objArray[l][name]
         
          for (let z = 0; z < existingArr.length; z++) {
           
            if (existingArr[z] == undefined) {
            } else {
              if (!Array.isArray(existingArr[z]) && existingArr[z] == name) {

               
                if (Array.isArray(existingArr[z + 1])) {
                  let innerArr = existingArr[z + 1]
                  for (let a = 0; a < innerArr.length; a++) {
                    if (Array.isArray(innerArr[a])) {
                      for (let l = 0; l < innerArr[a].length; l++) {
                        if (!Array.isArray(innerArr[a][l]) && innerArr[a][l] == catNew) {
                          if (innerArr[a][l + 1]) {
                            innerArr[a][l + 1].push(res)

                          } else {
                            let emptyArr = []
                            innerArr[a].push(emptyArr)
                            innerArr[a][l + 1].push(res)

                          }
                          break;
                        }
                        else {

                        }

                      }
                    }

                  }
                }


              }


            }
          }




        }

      }

    }


    //sending data to wix 

    let sendData = () => {
      let mainDataArr = []
      // get data we saved in array of object and  formate into needed data structure arrays of arrays then sent to wix
      for (let l = 0; l < objArray.length; l++) {
        mainDataArr.push(objArray[l][Object.keys(objArray[l])[0]])
      }

      if (arr.length > 0) {
        mainDataArr.push(arr)
        window.parent.postMessage({


          data: mainDataArr,

        },
          "https://jenksryan.editorx.io/hownot2/newfilters?siteRevision=290"
        );
      } else {
        window.parent.postMessage({


          data: mainDataArr,

        },
          "https://jenksryan.editorx.io/hownot2/newfilters?siteRevision=290"
        );
      }
    }
  </script>
</body>

</html>