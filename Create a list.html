<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: "Roboto";
    }

    #mainList {
      border: none;
      padding: 0;
      margin: 0;

    }

    .selectTagHeading {
      display: inline-block;
      font-size: 35px;
      font-weight: 400;
    }

    li {
      border: none;
      list-style: none;
      outline: none;
      text-decoration: none;
      /* display: flex;
      justify-content: space-between;
      flex-wrap: wrap; */
    }

    input {
      border: none;
      outline: none;
      font-size: 35px;
      color: black;
      background-color: rgba(255, 255, 255, 0);
      font-weight: 400;
    }

    button {
      font-weight: 300 !important;
    }

    .big_SuccessBtn {
      background-color: #BADA55;
      border: none;
      height: 45px;
      width: 144px;
      border-radius: 10px;
      font-size: 18px;
    }

    .innerDiv .big_SuccessBtn:hover {
      border: 1px solid black;
      background-color: white;

    }

    .big_DangerBtn {
      height: 45px;
      font-size: 18px;
      border: 1px solid black;
      background-color: white;
      width: 144px;
      border-radius: 10px;
    }

    .big_DangerBtn {
      background-color: #F1F1F1;
    }

    .btn-success {
      background-color: #BADA55;
      border: none;
      height: 38px;
      width: 103px;
      border-radius: 10px;
      font-size: 16px;
      margin-right: 20px;
    }

    .btn-success:hover {
      border: 1px solid black;
      background-color: white;
    }

    .btn-danger {
      height: 38px;

      font-size: 16px;
      border: 1px solid black;
      background-color: white;
      width: 103px;
      border-radius: 10px;
    }

    #tagSelectBtn {
      margin-top: -25px !important;
      margin-bottom: 20px;
    }

    .btn-danger:hover {
      background-color: #F1F1F1;
      /* border: none; */
    }


    .x {
      font-size: 20px;
    }

    .main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      /* padding-top: 70px; */
      /* padding-bottom: 70px; */
      border-bottom: 1px solid black;
    }

    .filterH2 {
      font-size: 80px;
      font-weight: 400 !important;
    }

    /* .firstDiv {
      background-color: #f1f1f1; 
      padding: 34px;

    } */

    .selectDiv {
      background-color: white;
      margin-top: 80px;
      min-height: 425px;
      border-radius: 30px;
      box-shadow: 2px 2px 15px rgba(128, 128, 128, 0.541);
      width: 100%;
      margin: 0 auto;
    }

    .sub {
      padding-top: 80px;
      margin: 80px;
      border-bottom: 2px solid #BADA55;
      /* background-color: #F1F1F1; */
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .subDiv {

      margin-left: 80px;
      margin-right: 80px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      padding: 34px;
      background-color: #F1F1F1;
      border-radius: 10px;
    }

    .mainFilterDiv {

      margin-top: 80px;
      min-height: 425px;
      border-radius: 30px;
      box-shadow: 2px 2px 15px rgba(128, 128, 128, 0.541);
      padding-bottom: 80px;

    }

    .listitem {
      display: flex;
      padding-top: 80px;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin: 80px;
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 2px solid #BADA55;

    }

    .subtagList {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
      margin-top: 12px;
    }

    .category input {
      font-size: 22px;
      font-weight: 400;
    }

    .tags input {
      font-size: 16px;
      font-weight: 400;
    }

    .innerTagDiv {
      background-color: #F1F1F1;
      padding: 34px;
      margin-bottom: 20px;
      margin: 40px 80px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* align-items: flex-end; */
    }

    #tagSelectBtn {
      align-self: flex-end;

    }

    .swal-modal {
      width: 650px;
      min-width: 320px;
      padding: 40px 70px;
      border-radius: 30px;
      border: 1px solid black;

    }

    /* //style of scrollbar */
    ::-webkit-scrollbar {
      width: 5px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
      background: black;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* //style of scrollbar */
    .swal-overlay {
      background-color: rgba(255, 255, 255, 0.733);
    }

    .swal-footer {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .swal-modal button {
      background-color: #BADA55 !important;
      font-weight: 300;
      width: 144px;
      border: 2px solid #BADA55;


    }

    .swal-modal button:hover {
      background-color: white !important;
      border: 2px solid #BADA55;
      color: black;

    }

    .swal-modal input {
      border: 1px solid rgb(85, 85, 85);
      font-weight: 400;
      color: black;
      margin-top: 40px;
    }

    .swal-modal input:focus {

      border: 1px solid rgb(85, 85, 85);
      box-shadow: 0px 1px 1px 1px rgba(87, 87, 87, 0.219);

    }

    .swal-title {
      margin-bottom: 30px;
      border-bottom: 1px solid #BADA55;
    }

    .swal-title:first-child {
      margin: 0;
    }

    .swal-title {
      padding-bottom: 20px;
    }

    .swal-title:not(:first-child) {
      padding-bottom: 30px;
    }

    .mainListDiv {
      opacity: 1;
      background-color: white;
    }

    button {
      font-family: "Roboto";

    }

    .selectSubCat {
      padding-top: 20px;
      width: 200px;
    }

    /* //style for existing tags */
    .childDiv {
      margin-bottom: 25px;
    }

    .childDiv input {
      font-size: 16px !important;

    }

    .btns {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      width: 250px;
      font-weight: 300;
    }

    .cat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
    }

    .cat input {
      font-size: 18px !important;
      font-weight: 400;

    }

    .subTagsdiv {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      background-color: #F1F1F1;
      padding: 20px;
      border-radius: 12px;
    }

    .selectCatexist {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #F1F1F1;
      padding: 20px;
      border-radius: 12px;
    }

    .addedFilters {
      margin: 80px;
    }
  </style>
</head>

<body>

  <div class="main container" id="main">
    <h2 class="filterH2">Filter</h2>
    <div class="inner-div">
      <button class="btn big_DangerBtn" onclick="reset()"><span class="x">X</span> Clear All</button>
      <button class=" big_SuccessBtn" onclick="sendData()">Save Changes</button>
    </div>
    <!-- <input id="mainInput" type="text" disabled value="Select Tag Heading" class="form-control" /> -->
  </div>

  <div class="mainListDiv">
    <ul id="mainList"></ul>
  </div>
  <div class="selectDiv">
    <div class="sub">
      <h2 class="selectTagHeading">Select Tag Heading</h2>
      <button class="big_SuccessBtn" onclick="start()">Select</button>
    </div>
    <div id="addedFilters" class="addedFilters">

    </div>
  </div>

  <script>
    let objArray = []
    window.onmessage = (event) => {
      addedFilters(event.data.data)
    }
    var arrayCount = 0;
    function start() {
      arrayCount++
      swal({
        title: "Select Tag Heading",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",
            button: "success"
          },
        },
      }).then((res) => {
        try {

          console.log("result...........", res);
          res = res.toLowerCase();

        } catch (error) {
          console.log(error);
        }
        if (res.trim() == "" || null || undefined) {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          createFun(res);
          createArray(res, "heading")
        }
      });
    }
    function createFun(data) {
      // document.getElementById("mainInput").value=data
      let liValue = data;

      // if (liValue == "") {
      //   swal("Oops", "Input Cant Be Empty", "error");
      //   return 0;
      // } else if (!liValue.trim().length) {
      //   mainInput.value = "";
      //   return 0;
      // }

      let list = document.getElementById("mainList");
      let FirstDiv = document.createElement("div")
      let divLi = document.createElement("div");
      let li = document.createElement("li");
      let inp = document.createElement("input");
      let edit = document.createElement("button");
      let del = document.createElement("button");
      let subLi = document.createElement("div");
      let subDiv = document.createElement("div");
      let selectBtn = document.createElement("button");
      let selectCatogery = document.createElement("span")

      edit.innerHTML = "EDIT";
      del.innerHTML = "DELETE";
      selectBtn.setAttribute("class", "btn-danger")
      selectBtn.innerHTML = "Select";
      selectBtn.setAttribute("id", "select");
      selectBtn.setAttribute(
        "onclick",
        "createInnerTag(this.parentElement.parentElement,this)"
      );

      selectCatogery.innerHTML = "Select Category"
      selectCatogery.setAttribute("class", "selectCat")

      FirstDiv.setAttribute("class", "firstDiv")
      divLi.setAttribute("class", "mainFilterDiv")
      edit.setAttribute("id", "edit");
      edit.setAttribute("onclick", "updt(this.parentElement)");
      edit.setAttribute("class", " btn btn-success");

      del.setAttribute("id", "del");
      del.setAttribute("onclick", "del(this.parentElement.parentElement.parentElement,this.parentElement)");
      del.setAttribute("class", "btn btn-danger ");

      inp.setAttribute("id", "listInput");
      inp.setAttribute("disabled", "disabled");
      inp.setAttribute("class", "list-input form-control");

      li.setAttribute("id", "li");
      li.setAttribute("class", "listitem");

      subDiv.setAttribute("class", "subDiv")
      subLi.setAttribute("class", "subLi")

      list.appendChild(FirstDiv);
      FirstDiv.appendChild(divLi)
      divLi.appendChild(li);
      divLi.appendChild(subDiv)
      li.appendChild(inp);
      li.appendChild(subLi);
      // subLi.appendChild(del);
      subDiv.appendChild(selectCatogery);
      subDiv.appendChild(selectBtn);
      subLi.appendChild(edit);
      subLi.appendChild(del);

      inp.value = liValue;
      console.log("swal value...........", liValue);
      // mainInput.value = "";
    }
    //first function ends

    //........second function...............................function for inner tag............................

    function createInnerTag(parentRes, btn) {
      console.log("print result button ...................", btn);
      swal({
        title: "Select Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",
          },
        },
      }).then((res) => {
        try {

          console.log("result...........", res);
          str = res
          const lower = str.toLowerCase();
          res = str.charAt(0).toUpperCase() + lower.slice(1);
        } catch (error) {
          console.log(error);
        }
        if (res.trim() == "" || res == "") {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          createArray(res, 'innertag')

          let subLi = document.createElement("li");
          let inpSub = document.createElement("input");
          let buttonsDiv = document.createElement("div");

          let subDel = document.createElement("button");
          let subEdit = document.createElement("button");
          let tagSelectBtn = document.createElement("button");
          let innerTagDiv = document.createElement("div");
          let selectSubCatogery = document.createElement("span")

          selectSubCatogery.innerHTML = "Select Sub Category"
          selectSubCatogery.setAttribute("class", "selectSubCat")

          inpSub.value = res;
          tagSelectBtn.innerHTML = "Select";
          tagSelectBtn.setAttribute("id", "tagSelectBtn");
          tagSelectBtn.setAttribute("class", "btn-danger")
          tagSelectBtn.setAttribute(
            "onclick",
            "createSubTag(this.parentElement,this)"
          );

          tagSelectBtn.style.marginTop = "12px";
          subLi.setAttribute("class", "subtagList category")
          innerTagDiv.setAttribute("class", "innerTagDiv")
          subEdit.innerHTML = "EDIT";
          subDel.innerHTML = "DELETE";
          subEdit.setAttribute("id", "subEdit");
          subEdit.setAttribute("onclick", "updt(this.parentElement)");
          subEdit.setAttribute("class", " btn btn-success");

          inpSub.setAttribute("id", "subInput");
          inpSub.setAttribute("disabled", "disabled");
          inpSub.setAttribute("class", "list-input form-control");

          subDel.setAttribute("id", "subDel");
          subDel.setAttribute(
            "onclick",
            "del(this.parentElement.parentElement.parentElement,this.parentElement)"
          );
          subDel.setAttribute("class", "btn btn-danger ");

          parentRes.appendChild(innerTagDiv);
          innerTagDiv.appendChild(subLi);
          subLi.appendChild(inpSub);
          subLi.appendChild(buttonsDiv);
          buttonsDiv.appendChild(subEdit);
          buttonsDiv.appendChild(subDel);

          innerTagDiv.appendChild(selectSubCatogery);
          innerTagDiv.appendChild(tagSelectBtn);

          // btn.style.display = "none";
          console.log("button btn direct", btn);
          console.log(
            "log button target from dom",
            parentRes.firstElementChild.firstElementChild
          );
        }
      });


    }
    //.............................second function ends...............

    // .............................third sub tag function starts.................\
    let createSubTag = (data) => {
      console.log("log event..................", data);
      //trigger swal get values in swwetalert input and if its not empty update on dom created input
      swal({
        title: "Select Sub Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Type here",
            type: "text",

          },
        },
      }).then((res) => {
        try {
          str = res
          const lower = str.toLowerCase();
          res = str.charAt(0).toUpperCase() + lower.slice(1);

        } catch (error) {
          console.log(error);
        }

        if (res.trim() == "null" || res == "") {
          swal("Oops", "Input Cant Be Empty", "error");
        } else {
          createArray(res, 'subtag')


          let tagLi = document.createElement("li");
          let tagInpt = document.createElement("input");
          let tagButtonDiv = document.createElement("div")
          let tagDel = document.createElement("button");
          let tagEdit = document.createElement("button");


          tagLi.setAttribute("class", "subtagList tags")
          tagEdit.innerHTML = "EDIT";
          tagDel.innerHTML = "DELETE";
          tagEdit.setAttribute("id", "tagEdit");
          tagEdit.setAttribute("onclick", "updt(this.parentElement)");
          tagEdit.setAttribute("class", " btn btn-success");

          tagInpt.setAttribute("id", "listInput");
          tagInpt.setAttribute("disabled", "disabled");
          tagInpt.setAttribute("class", "list-input form-control");

          tagDel.setAttribute("id", "tagDel");
          tagDel.setAttribute("onclick", "del(this.parentElement.parentElement,this.parentElement)");
          tagDel.setAttribute("class", "btn btn-danger ");

          data.appendChild(tagLi);
          tagLi.appendChild(tagInpt);
          tagLi.appendChild(tagButtonDiv);
          tagButtonDiv.appendChild(tagEdit)
          tagButtonDiv.appendChild(tagDel);

          tagInpt.value = res;
        }
      });
    };

    // .............................third sub tag function end.................
    let arr = []; //nested array of new tags 
    function reset() {
      //remove every filter 
      arr = []
      arrayCount = 0;
      let list = document.getElementById("mainList");
      swal("Removed", "List Cleared", "success");
      list.innerHTML = "";
    }
    //....................edit button function
    function updt(edit) {
      // console.log("edit value ",edit.previousElementSibling.value)
      let preVal = edit.previousElementSibling.value
      // console.log("preVal ", preVal)
      // for(let i=0;i<arr.length;i++){
      //   console.log("array items ",arr[i])
      // }

      //trigger sweet alert takes a value and trigger inner update function if value is not emmpty
      swal({
        content: {
          element: "input",
          attributes: {
            placeholder: "Edit",
            type: "text",
          },
        },
      }).then((res) => {
        // console.log("result...........", res);
        innerupdate(edit, res, preVal);
      });
    }
    //........................... update value in input from sweet alert
    function innerupdate(edit, res, preVal) {
      if (res.trim() == "" || null) {
        swal("Edit", "Value cant be Empty", "error");
      } else {
        swal("Edit", "Title Edited", "success");
        // console.log("log dit.previousSibling....", edit.previousSibling);
        let newVal = edit.previousElementSibling.value = res;
        for (let z = 0; z < arr.length; z++) {
          if (arr[z] == undefined) {
          } else {
            if (!Array.isArray(arr[z]) && arr[z] == preVal) {
              arr[z] = newVal
              console.log(arr);
              break;
              // console.log("item not array", arr[z]);
            }

            if (Array.isArray(arr[z])) {
              console.log("item  is array arr[z][0]", arr[z])
              for (let a = 0; a < arr[z].length; a++) {

                if (Array.isArray(arr[z][a])) {
                  for (let l = 0; l < arr[z][a].length; l++) {
                    if (!Array.isArray(arr[z][a][l]) && arr[z][a][l] == preVal) {
                      arr[z][0][a] = newVal
                      console.log("log cat", arr[z][a][l])
                      break;
                    }
                    else {
                      console.log("is an array in tags")
                      // if (Array.isArray(arr[z][0][a])) {
                      for (let p = 0; p < arr[z][a][l].length; p++) {
                        console.log("a z o", arr[z][a][l][p]);
                        if (!Array.isArray(arr[z][a][l][p]) && arr[z][a][l][p] == preVal) {
                          arr[z][a][l][p] = newVal
                          break;
                        }
                      }
                    }

                  }
                }




              }
            }
          }

          console.log(arr[z])
        }

      }
      // console.log("Updatee Array ",arr.indexOf('Tag'))


    }

    function del(data, updata) {
      //..........................remove element.....................
      //use array  map and regix 
      try {

        //...................check get attribute of input next to select button
        if (
          data.firstElementChild.firstElementChild.getAttribute("id") ==
          "subInput"
        ) {
          document.getElementById("select").style.display = "block";
        }
      } catch (err) {
        console.log("catch error", err);
        // console.log("catch error", check);
      }
      // let check=data.firstElementChild.firstElementChild.value
      // arr = arr.filter(function (valueRemov, index, arr) {
      //           return valueRemov !== check;
      //       });
      let newVal = updata.previousElementSibling.value;
      console.log("value .................del", newVal);
      for (let z = 0; z < arr.length; z++) {
        if (arr[z] == undefined) {
        } else {
          if (!Array.isArray(arr[z]) && arr[z] == newVal) {
            let index = arr.indexOf(newVal)
            console.log("logging array z", arr[z]);
            arr = []

            break;
            // console.log("item not array", arr[z]);
          }

          if (Array.isArray(arr[z])) {
            console.log("item  is array arr[z][0]", arr[z][0])
            for (let a = 0; a < arr[z].length; a++) {
              for (let x = 0; x < arr[z][a].length; x++) {
                if (!Array.isArray(arr[z][a][x]) && arr[z][a][x] == newVal) {
                  arr[z][a].splice(a, 1)

                  console.log("log cat", arr[z][a])
                  console.log(arr);
                  break;
                } else {
                  console.log("is an array in tags")
                  // if (Array.isArray(arr[z][0][a])) {
                  for (let p = 0; p < arr[z][a][x].length; p++) {
                    console.log("a z o", arr[z][a][x][p]);
                    if (!Array.isArray(arr[z][a][x][p]) && arr[z][a][x][p] == newVal) {
                      arr[z][a][x].splice(p, 1)
                      console.log(arr);
                    }
                  }
                }
              }



            }
          }
        }

        console.log(arr[z])
      }

      //zzzzzzzzzzzz
      console.log("array ", data);
      data.remove();
      swal("Remove", "Tag removed", "success");
    }

    //create array
    let head = 1
    let category = -1
    function createArray(data, prop) {

      console.log("logging data in create array function", data);
      console.log("logging data in create array  prop", prop);
      if (prop == "heading") {
        arr.push(data, [])
        console.log("log second index of array. heading.........", arr);
      } else if (prop == "innertag") {

        arr[1].push([data, []])
        category++
        console.log("log second index of array. innertag.........", arr);
      } else if (prop == "subtag") {

        arr[1][category][1].push(data)
        // category++
        // console.log("test log",test);
        console.log("log array in subtag............", arr[1][0][1]);

        console.log("logging array", arr);
      }
    }


    ///all done and working


    // added filters render
    let addedFilters = (main) => {
      for (let b = 0; b < main.length; b++) {
        var newEl = main[b][0];
        console.log("new Element", newEl);
        let newObj = {}
        newObj[newEl] = main[b]
        objArray.push(newObj)

      }
      console.log("log array of objects$$$$$$$$$$$$$$$$$$$$$$$", objArray);
      let tags = document.getElementById("addedFilters");
      for (let x = 0; x < main.length; x++) {
        let mainDiv = document.createElement("div");
        // mainDiv.style.width = "400px";
        let heading = document.createElement("input");
        heading.style.padding = "10px";
        heading.style.fontSize = "40px";
        heading.disabled = "true";
        heading.setAttribute("name", `${JSON.stringify(main[x])}`)
        heading.style.borderBottom = "2px solid #BADA55";
        console.log("logging heading name", JSON.parse(heading.name));
        mainDiv.append(heading);
        heading.value = main[x][0];
        let arr = main[x][1];
        for (let i = 0; i < arr.length; i++) {
          //.............................first loop......................

          //...............................second loop...........................

          for (let z = 0; z < arr[i].length; z++) {
            let childDiv = document.createElement("div");

            childDiv.setAttribute("class", "childDiv");
            childDiv.setAttribute("id", `${arr[i][0].replace(/ /g, "").toLowerCase().toString()}`);
            childDiv.style.display = "";
            let fstChild = document.createElement("div");
            if (arr[i][z] == undefined) {
            } else {
              if (!Array.isArray(arr[i][z])) {
                //console.log("i z...........", arr[i][z]);
                fstChild.innerHTML += `<div class="cat"> 
    <input   class="heading"  style="margin-bottom:10px" disabled placeholder="${arr[i][z]
                  }" id="${arr[i][z].replace(/ /g, "")}" name="${i.toString() + ""}" value="${arr[i][z]
                  }"> 
          <div class="btns ">
            <button class="btn-danger" id="${arr[i][z].replace(/ /g, "")}del" onclick="delExisting(this.parentElement.parentElement,this.parentElement)"  style=" margin-right: 10px;">Delete</button>
            <button class="btn-success" id="${arr[i][z].replace(/ /g, "")}edt"onclick="updtExist(this.parentElement)" style=" margin-right: 0px;" >Edit</button>
            </div>
    </div>
    <div class="selectCatexist"  >
      <span>Add Subcatogery</span> 
      <button class="btn-danger" onclick="addTagAddedFilter(this.parentElement.previousElementSibling.firstElementChild)" >Select</button>
      </div>

    `;
                mainDiv.append(fstChild);
              }
            }
            if (Array.isArray(arr[i][z])) {
              //................................third loop..................................//
              let text = "";
              let a = 0;
              do {


                // for (let a = 0; a < arr[i][z].length; a++) {
                //  console.log("a i z log ...............", arr[i][z][a]);
                childDiv.innerHTML += `<div class="subTagsdiv"  style=" margin-left: 35px;">
    <input   style=" margin-left: 15px;" disabled placeholder="${arr[i][z][a]
                  }" id="${arr[i][z][a].replace(/ /g, "")}" name="${(i.toString() + "," + a.toString())
                  }" value="${arr[i][z][a]}"> 
                   <div class="btns"><button class="btn-danger" id="${arr[i][z][a].replace(/ /g, "")}del" name="subCat" onclick="delExisting(this.parentElement.parentElement,this.parentElement,this.name)" style=" margin-right: 10px;">Delete</button>
                    <button class="btn-success" id="${arr[i][z][a].replace(/ /g, "")}edt" onclick="updtExist(this.parentElement)" style=" margin-right: 0px;" >Edit</button></div>
    </div>`;

                mainDiv.append(childDiv);
                a++;
              }
              while (a < arr[i][z].length);
              // }
            } else {
              mainDiv.append(childDiv);
            }
            tags.append(mainDiv);
          }
        }
      }
    }
    //add catogery to existing filter
    let addTagAddedFilter = (data) => {
      console.log("************************* data in already created filters  select button function  *****************", data.parentElement.parentElement.firstElementChild.firstElementChild.value, data.parentElement.parentElement.parentElement.firstElementChild.name);
      swal({
        title: "Add Sub Category",
        content: {
          element: "input",
          attributes: {
            placeholder: "Add",
            type: "text",
          },
        },
      }).then((res) => {
        console.log("result...........", res);
        let divId = data.value.replace(/ /g, "").toLowerCase().toString()
        let divToAppen = document.getElementById(divId)
        console.log("log data........div to append*************", divToAppen);
        let ipts = document.createElement("div")
        ipts.setAttribute("class", "subTagsdiv")
        ipts.style.marginLeft = "35px"
        // <div class="subTagsdiv"  style=" margin-left: 35px;">
        ipts.innerHTML = `
    <input   style=" margin-left: 15px;" disabled placeholder="" id="${res.replace(/ /g, "")}" name="${(res.toString())}" 
            value="${res}"> 
             <div class="btns">
              <button type="button" class="btn-danger" id="${res.replace(/ /g, "")}del" name="subCat" onclick="delExisting(this.parentElement.parentElement,this.parentElement,this.name)" style=" margin-right: 10px;">Delete</button>
              <button  class="btn-success" onclick="updtExist(this.parentElement)" id="${res.replace(/ /g, "")}edt"  style=" margin-right: 0px;" >Edit</button>
              </div>`
        divToAppen.append(ipts)

        NewTagsToEsisting(data.parentElement.parentElement.firstElementChild.firstElementChild.value, data.parentElement.parentElement.parentElement.firstElementChild.name)
      });
    }

    //update existing filters

    //....................edit button function
    function updtExist(edit) {
      // console.log("edit value ",edit.previousElementSibling.value)
      let preVal = edit.previousElementSibling.value
      console.log("preVal ", preVal)
      // for(let i=0;i<existingArr.length;i++){
      //   console.log("array items ",existingArr[i])
      // }

      //trigger sweet alert takes a value and trigger inner update function if value is not emmpty
      swal({
        title: "Update",
        content: {
          element: "input",
          attributes: {
            placeholder: "Edit",
            value: preVal,
            type: "text",
          },
        },
      }).then((res) => {
        console.log("result...........", res);
        innerupdatExist(edit, res, preVal);
      });
    }
    //........................... update value in input from sweet alert
    let existingArr = [];
    function innerupdatExist(edit, res, preVal) {
      if (existingArr.length == 0) {
        existingArr = JSON.parse(edit.parentElement.parentElement.parentElement.firstElementChild.name)
      }
      if (res.trim() == "" || null) {
        swal("Edit", "Value cant be Empty", "error");
      } else {
        swal("Edit", "Title Edited", "success");
        let newVal = edit.previousElementSibling.value = res;
        // console.log("log array existing.", edit.parentElement.parentElement.parentElement.firstElementChild.name);
        for (let z = 0; z < existingArr.length; z++) {
          if (existingArr[z] == undefined) {
          } else {
            if (!Array.isArray(existingArr[z]) && existingArr[z] == preVal) {
              existingArr[z] = newVal
              // console.log(existingArr);
              break;
              // console.log("item not array", existingArr[z]);
            }

            if (Array.isArray(existingArr[z])) {
              // console.log("item  is array existingArr[z][0]", existingArr[z])
              for (let a = 0; a < existingArr[z].length; a++) {

                if (Array.isArray(existingArr[z][a])) {
                  for (let l = 0; l < existingArr[z][a].length; l++) {
                    if (!Array.isArray(existingArr[z][a][l]) && existingArr[z][a][l] == preVal) {
                      existingArr[z][0][a] = newVal
                      // console.log("log cat", existingArr[z][a][l])
                      break;
                    }
                    else {
                      // console.log("is an array in tags")
                      // if (Array.isArray(existingArr[z][0][a])) {
                      for (let p = 0; p < existingArr[z][a][l].length; p++) {
                        // console.log("a z o", existingArr[z][a][l][p]);
                        if (!Array.isArray(existingArr[z][a][l][p]) && existingArr[z][a][l][p] == preVal) {
                          existingArr[z][a][l][p] = newVal
                          break;
                        }
                      }
                    }

                  }
                }

              }
            }
          }
          //check if that object is present if exist replace else push 
          let updArr = {}
          let objProperty = existingArr[0]
          updArr[objProperty] = existingArr
          if (objArray.length == 0) {
            objArray.push(updArr)
          } else {
            for (let p = 0; p < objArray.length; p++) {
              // console.log("property and obj",objProperty, objArray[p][objProperty]);
              // var headName=
              let element = objArray[p];
              // console.log("log objects one by one",element);
              if (objArray[p][objProperty]) {
                objArray[p] = updArr
                console.log("check if object changed", objArray[p]);
              } else {
                // objArray.push({newVal:updArr})
                console.log("no data found");
              }
            }
          }
          // console.log("existing arrray updated", existingArr)
        }
      }
      // console.log("Updatee Array ",existingArr.indexOf('Tag'))
    }
    //function for already existing filters delete remove
    function delExisting(data, updata,newProp) {
      //..........................remove element.....................
      let existingArr;
      let name = updata.parentElement.parentElement.parentElement.firstElementChild.name
      name=JSON.parse(name)
      name=name[0]
      console.log("name of object", name);
      for (let l = 0; l < objArray.length; l++) {
        // let element = objArray[l];
        console.log("log object array value",objArray[l] );
        if(objArray[l][name]){
          existingArr= objArray[l][name]
          console.log("data found");
        }else{
        //  console.log("error cant find any data",objArray,name);
        }

      }

      let newVal = updata.previousElementSibling.value;
      console.log("value .................del", newVal);
      for (let z = 0; z < existingArr.length; z++) {
        if (existingArr[z] == undefined) {
          // existing array is undefiened
          console.log("existing array is undefiened");
        } else {
          if (!Array.isArray(existingArr[z]) && existingArr[z] == newVal) {
            let index = existingArr.indexOf(newVal)
            // console.log("logging array z", existingArr[z]);
            existingArr = []
            break;
            // console.log("item not array", existingArr[z]);
          }
          if (Array.isArray(existingArr[z])) {
            console.log("item  is array existingArr[z][0]", existingArr[z][0])
            for (let a = 0; a < existingArr[z].length; a++) {
              for (let x = 0; x < existingArr[z][a].length; x++) {
                if (!Array.isArray(existingArr[z][a][x]) && existingArr[z][a][x] == newVal) {
                  existingArr[z][a].splice(a, 1)

                  console.log("log cat", existingArr[z][a])
                  console.log(existingArr);
                  break;
                } else {
                  console.log("is an array in tags")
                  // if (Array.isArray(existingArr[z][0][a])) {
                  for (let p = 0; p < existingArr[z][a][x].length; p++) {
                    // console.log("a z o", existingArr[z][a][x][p]);
                    if (!Array.isArray(existingArr[z][a][x][p]) && existingArr[z][a][x][p] == newVal) {
                      existingArr[z][a][x].splice(p, 1)
                      console.log("log index p ..........",p);
                    }
                  }
                }
              }
            }
          }
        }

        console.log("loging existing array", existingArr[z])
      }

      //zzzzzzzzzzzz
      console.log("array ", data);
      if (newProp == "subCat") {
        data.remove();
      } else {
try {
  
  data.parentElement.nextElementSibling.nextElementSibling.remove()
  data.parentElement.nextElementSibling.remove()
  data.parentElement.remove()
} catch (error) {
  data.parentElement.nextElementSibling.remove()
  data.parentElement.remove()
  
}

      // console.log(  data.parentElement.nextElementSibling.nextElementSibling);
      }
      console.log("log child divnext to category"), data;
      swal("Remove", "Tag removed", "success");
    }

    //add new tags data to existing tags
    let NewTagsToEsisting = (catNew, headArray) => {
      headArray = JSON.parse(headArray)
      for (let l = 0; l < objArray.length; l++) {
        // let element = objArray[l];
        console.log("log object array value",objArray[l][headArray[0]] );
        // if()
      }

      console.log("log cat new.........", catNew, headArray[0]);

    }


        //sending data to wix 
        let sendData = () => {
      let mainDataArr=[]
      console.log("save btn clicked");
      for (let l = 0; l < objArray.length; l++) {
        // let element = objArray[l];
        // console.log("log object array value", objArray[l][Object.keys( objArray[l])[0]] );
        mainDataArr.push(objArray[l][Object.keys( objArray[l])[0]] )
      }
      console.log("arr main created.................##3##########",arr);
      
      if (arr.length > 0) {
        mainDataArr.push(arr)
        window.parent.postMessage({


          data: mainDataArr,

        },
          "https://jenksryan.editorx.io/hownot2/newfilters?siteRevision=290"
        );
      } else {
        window.parent.postMessage({


data: mainDataArr,

},
"https://jenksryan.editorx.io/hownot2/newfilters?siteRevision=290"
);
      }
    }
  </script>
</body>

</html>